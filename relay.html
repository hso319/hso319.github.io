<!doctype html>
<meta charset="utf-8" />
<title>Relay</title>
<script>
  (function () {
    // next= 으로 전달된 앱 딥링크 (예: exp://.../--/password-reset)
    var params = new URLSearchParams(location.search);
    var next = params.get("next");
    if (!next) {
      document.body.innerText = "Missing next param.";
      return;
    }

    // Supabase가 붙여준 토큰/파라미터: location.hash 에 들어옴
    // 예) #access_token=...&refresh_token=...&type=recovery ...
    var hash = (location.hash || "").replace(/^#/, ""); // 앞의 # 제거

    // hash 를 쿼리로 변환해서 next 로 전달
    // next 에 이미 ?가 있으면 & 로 이어 붙임
    var sep = next.indexOf("?") >= 0 ? "&" : "?";
    var url = next + (hash ? sep + hash : "");

    // 실제 앱 딥링크로 이동
    location.replace(url);
  })();
</script>
